name: Notify Discord on PR

on:
  pull_request:
    types: [opened, reopened, closed]

jobs:
  notify-discord:
    runs-on: ubuntu-latest

    steps:
      - name: –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ü–≤–µ—Ç embed
        id: set_color
        run: |
          COLOR=""
          if [[ "${{ github.event.action }}" == "closed" && "${{ github.event.pull_request.merged }}" == "true" ]]; then
            COLOR=3066993  # –∑–µ–ª—ë–Ω—ã–π
          elif [[ "${{ github.event.action }}" == "closed" ]]; then
            COLOR=9807270  # —Å–µ—Ä—ã–π
          elif [[ "${{ github.event.action }}" == "reopened" ]]; then
            COLOR=16776960 # –∂—ë–ª—Ç—ã–π
          else
            COLOR=7506394  # —Å–∏–Ω–∏–π
          fi
          echo "color=$COLOR" >> $GITHUB_OUTPUT

      - name: –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Discord
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          curl -X POST -H "Content-Type: application/json" \
          -d '{
            "embeds": [
              {
                "title": "üì• Pull Request: ${{ github.event.pull_request.title }}",
                "url": "${{ github.event.pull_request.html_url }}",
                "color": ${{ steps.set_color.outputs.color }},
                "author": {
                  "name": "${{ github.event.pull_request.user.login }}",
                  "icon_url": "${{ github.event.pull_request.user.avatar_url }}"
                },
                "fields": [
                  {
                    "name": "üìÇ –í–µ—Ç–∫–∏",
                    "value": "`${{ github.event.pull_request.head.ref }}` ‚Üí `${{ github.event.pull_request.base.ref }}`",
                    "inline": true
                  },
                  {
                    "name": "üìå –°—Ç–∞—Ç—É—Å",
                    "value": "`${{ github.event.action }}`",
                    "inline": true
                  },
                  {
                    "name": "üßë‚Äçüíº –ê–≤—Ç–æ—Ä",
                    "value": "`${{ github.event.pull_request.user.login }}`",
                    "inline": true
                  },
                  {
                    "name": "üìù –û–ø–∏—Å–∞–Ω–∏–µ",
                    "value": "${{ github.event.pull_request.body || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è.' }}",
                    "inline": false
                  },
                  {
                    "name": "üìä –ò–∑–º–µ–Ω–µ–Ω–∏—è",
                    "value": "`+${{ github.event.pull_request.additions }} / -${{ github.event.pull_request.deletions }}` –≤ ${{ github.event.pull_request.changed_files }} —Ñ–∞–π–ª–∞—Ö",
                    "inline": false
                  }
                ],
                "footer": {
                  "text": "üîÉ Pull Request #${{ github.event.pull_request.number }}"
                },
                "timestamp": "${{ github.event.pull_request.updated_at }}"
              }
            ]
          }' \
          $DISCORD_WEBHOOK
